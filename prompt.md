# 开发任务
我想要开发一个德州扑克/牛牛记分前后端程序,主要用来在多人德州扑克/牛牛时,每个人可以使用该网页进行下注.
主要用于朋友和同学聚会时,进行德州扑克/牛牛游戏时使用.

# 技术栈与约定
前端位于poker_score_frontend目录下,使用vue开发.使用ts+pinia+vue-router+eslint+prettier进行开发.目前已经通过官方脚手架初始化好了.使用ant-design-vue进行UI组件库.

后端位于backend目录下,使用go开发.使用gin框架.我希望使用sqllite进行数据库操作,相关依赖已经安装了.

我们要求前后端的接口使用json格式进行传输,并且写在docs目录下,前后端都严格按照接口开发.

其余技术栈你可以自由选型,但是请你在docs当中标注.要求尽可能轻量.我们的用户数不会很多,同一时间在线用户数不会超过100个.

表设计请你也记录在文档当中.

开发阶段,前端直接使用80端口,后端运行在8080端口.前端要能通过/api路径访问到后端接口.
目前现在本机上运行.

我们的前端主要面向移动端,在ui设计时主要考虑移动端适配.

代码使用中文注释,必要时给出详细解释.注释尽可能详细.

你应该多使用日志,以记录动态运行的情况.

完成后,你需要尽可能进行测试.

# 项目详细需求
## 前端描述
界面设计最好足够简约优雅.
### 主页面
主页面展示: 首页首先需要展示"筹码计分器"几个字.随后依次有几个按钮:
1. 创建房间按钮:点击后弹出一个弹窗,弹窗里要求用户选择是要创建"德扑房间"还是"牛牛房间".
选择之后,要求用户填入一个数据:"积分和人民币比例",德扑房间默认值设为20:1,牛牛房间默认值设为1:1
选择后,根据用户的选择自动创建一个房间,自动进入房间页面.房间创建后,会生成一个6位数字的房间号.同时,我们在后端要标记该用户加入了该房间.
1. 加入房间按钮:点击后弹出提示框,输入房间号,就能加入其他人创建的房间.同时,我们在后端要标记该用户加入了该房间.一旦用户的连接丢失,我们标记用户离开了该房间
2. 返回房间按钮:用户点击后,自动返回到上一次用户进入的房间.如果房间已经解散,则不能返回.如果进入成功,我们标记该用户进入了该房间
3. 个人信息按钮:用户点击后,跳转到个人信息页面.
4. 今晚战绩按钮:用户点击后,跳转到今晚战绩页面.
5. 后台管理按钮:仅仅当用户的身份为管理员时才可以看见这个按钮.用户身份主要分为"管理员用户"和"普通用户"两类.点击后进入后台管理页面.

上述按钮如果在用户没有登录的情况下进行点击,则自动跳转到登录页面,并提示用户先登录.

### 登录页面
主要有两个表单:手机号,密码.要求用户输入手机号和密码,点击登录按钮后,如果手机号和密码正确,则自动跳转到主页面.如果手机号和密码错误,则提示用户手机号或密码错误.
同时在该页面醒目地提示:"第一次使用?请先注册",用户点击"去注册"之后,跳转到注册页面.

### 注册页面
注册页面主要是三个表单:手机号,昵称,密码. 用户输入之后,点击"注册并登录"按钮,便同时完成注册和登录两个步骤.登录态应该在用户浏览器里保持永久有效.使用session技术进行管理.

### 个人信息页面
个人信息主要提供"修改昵称","修改密码","登出账户"三个按钮.整个程序均不涉及到头像.

### 后台管理页面
后台管理页面你可以自由发挥,但是要手机端显示良好,并且最基本的用户管理,房间管理要显示.你还需要展示用户的加入和离开房间的历史记录.房间管理页面需要展示每个房间里各个用户的盈亏情况.同时,还需要有界面展示每个用户的历史盈亏状况.

### 今晚战绩页面
今晚战绩页面有一个"时间段"选项,让用户选择要查询的时间段.我们同时约定一个默认值:如果当前时间在7时之前,就默认统计昨天7时到 今天7时之间的战绩.如果当前时间在7:00am之后,就默认统计今天7:00am到明天7:00am之间的战绩.这个选择功能要做的优雅,你可以想想如何实现比较用户友好.

我们定义在选定的时间段内,和当前用户曾在同一个房间的用户会被标记为"今晚一起玩过的好友".而"今晚一起玩过的好友"在当前时间段如果加入过别的房间,别的房间的参与者也会被标记为"今晚一起玩过的好友".有点类似于并查集的效果.

这个页面要展示的是每个用户的战绩,表格要展示在刚才用户设定的时间段内,和"今晚一起玩过的好友"的战绩,也就是盈亏情况.盈亏的单位是人民币. 逻辑上,这个页面展示的所有的人的盈亏情况加起来应该为0.

这个界面要统计当前用户仍在的房间.

### 房间页面
这是最为主要的页面,我们有以下约定:
1. 用户进入房间的一刻,后端要记录该用户进入了房间.如果用户的连接丢失,或者主动离开,后端要记录该用户离开了房间.
2. 当所有的用户都离开房间后,后端要记录该房间被解散.
3. 积分和人民币不等价.请不要混淆两个概念.
4. 任何弹窗在点击弹窗外的空白处时,都应该关闭弹窗.

#### 德州扑克页面
页面的最上方,横着依次展示"离开房间"按钮 和 展示用户昵称.点击"离开房间"按钮后,返回到主页.

页面的第二行,展示两个按钮:
1. 邀请好友:点击后弹出弹窗,展示房间的6位数字房间号.一个房间只有有一个房间号,但是你不应该把房间号认为是房间的唯一id,因为随着网站的运行,房间号可能会重复.
2. 积分排行: 点击后弹出弹窗,这里需要展示整个房间的盈亏情况.注意,这里展示的是每个用户的积分盈亏情况.同时,弹窗的下方应该有个按钮: "结算这局".
某一个用户点击后,要进行校验,校验是否桌面积分为0.如果桌面积分不为0,那么提示用户"桌面积分不为0,不能结算".如果桌面积分为0,那么会给所有在该房间的用户弹出一个新的弹窗,叫做"结算方案".
结算方案我们设定为:所有负积分的人,向正积分最高的人转账,正积分最高的人给其他正积分的人转账.转账的金额自动按照积分和人民币的比例进行计算.
点击"结算这局"的那个用户,"结算方案"弹窗的下方应该有个按钮: "确认结算".点击"确认结算"按钮之后,会清空桌面上和所有用户的积分.
如果不是点击"结算这局"的那个用户,那么就不会展示"确认结算"按钮.
点击确认结算之后,要在后端记录每个用户的盈亏情况.以便于在"今晚战绩"页面展示.

随后,页面的第三行,应该展示两个数据:"桌面积分"和"我的积分".我的积分是可以为负数的.房间里所有人的积分加起来应该为0.
这个第三行要比前两行更大.

前三行不能超过页面的1/3高度.

页面的第四部分,应该展示的"房间历史操作记录",每一条记录的最左边是时间(时:分:秒),然后展示房间里每一个用户的操作记录,包括但不限于:
1. 某某用户加入了房间
2. 某某用户离开了房间
3. 某某用户下注了xx积分
4. 某某用户收回了xx积分
5. 某某用户发起了结算
6. 某某用户被踢出了房间

当用户加入房间/重回房间时,他只能看到加入后的记录.

页面的底部应该有两个醒目的按钮:收回和支出.同时最左边有一个"更多功能"
点击收回后,弹出一个在页面底部的弹窗,要求用户输入收回的积分应该是多少.同时还在合适的位置给出一个"全收"按钮和"确认"按钮.点击"全收"按钮后,会收回桌面上所有的积分.点击"确认"按钮后,会收回用户输入的积分.

点击支出后,弹出一个在页面底部的弹窗,要求用户输入支出的积分应该是多少.同时还在合适的位置给出一个"确认"按钮.点击"确认"按钮后,会支出用户输入的积分.

为了方便用户的使用,我们在这两个弹窗里都应该给出6个按钮,按钮的内容用户在历史上曾经支出/收回过哪些积分(最近6条),用户点击按钮后,会自动支出/收回积分.

点击"更多功能"后,弹出一个菜单栏.这个菜单栏里目前只有一个功能:"有人走了?"按钮
点击这个按钮之后,会弹出一个弹窗,可以在弹窗里选择房间里的哪一个用户走了.选择之后,这个用户就会被踢出房间,同时后端要记录该用户离开了房间.他的积分不需要额外操作,因为我们在点击"结算"的时候会如实处理这个用户的盈亏情况.

应该能考虑到,需要分别记录"历史上"该房间有哪些用户和"现在房间在线哪些人".当现在房间没有在线的人时,房间应该被逻辑删除,用户不能再返回.

#### 牛牛页面
牛牛页面和德州扑克页面类似,但是某些细节不同.

向你解释一下牛牛的规则:一个人当"庄家",其他所有人当"闲家".每个人都发五张牌,在翻牌之前,每个人可以在任何闲家的牌上下注(你可以想象每个人拿着筹码放到自己或者别人的牌上).随后,每个闲家和庄家单独进行比较牌的大小.如果庄家赢了闲家,那么庄家赢走这个闲家牌上所有的筹码(这个筹码可能是别人下的,也可能是自己下的).反之,庄家就要赔给这个闲家牌上所有的筹码.

因此,我们略微修改牛牛的逻辑:点击界面下方的"下注"按钮,弹窗里会显示房间里所有的人,用户可以给房间的任何人"下注",(这是个多选框)同时输入下注的积分.点击"确认"按钮后,会支出该积分.同时,在"房间历史操作记录"里记录用户给谁谁谁下注了多少钱.其余的逻辑均和德扑界面类似.


## 后端描述
你应该根据我们的产品需求设置好数据库表结构,并设计好接口,并且自主设计好后端逻辑.